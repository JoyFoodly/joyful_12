<!-- A panel for a given list, which is in the local shopping_list and is assumed to not be empty -->

<% list_length = shopping_list.recipes.length %>

<div class="panel panel-default">
  <div class="panel-heading">
    <% if current %>
      <%= link_to 'Current list', edit_shopping_list_path('current') %>
    <% else %>
        <%= link_to shopping_list.name, edit_shopping_list_path(shopping_list) %>, Created on <%= shopping_list.created_at.strftime('%B %e, %Y') %>
    <% end %>

    <%= form_tag edit_shopping_list_path(shopping_list), method: :get, class: 'pull-right' do %>
      <%= submit_tag 'Edit', class: 'btn btn-sm btn-default' %>
    <% end %>
    <%= form_tag shopping_list_emails_path, method: :post, class: 'pull-right' do %>
      <%= hidden_field_tag 'shopping_list_email[shopping_list_id]', shopping_list.id %>
      <%= submit_tag 'Email', class: 'btn btn-sm btn-default' %>
    <% end %>

    <% if !current %>
      <%= form_tag shopping_list_path(shopping_list), method: :delete, class: 'pull-right' do %>
	<%= submit_tag "Remove", method: :delete, confirm: 'Are you sure you want to delete this shopping list?',
	class: 'btn btn-sm btn-default' %>
      <% end %>
    <% end %>

    <%= form_tag shopping_list_path(shopping_list), method: :get, class: 'pull-right' do %>
      <%= submit_tag 'Print', class: 'btn btn-sm btn-default' %>
    <% end %>
  </div>

  <div class="panel-body">
    <% if list_length > 0 %>
      <% # For up to 4 recipes in the list, display them in the panel %>
      <% shopping_list.recipes[0..[3, list_length].min].each do |recipe| %>
	<div class="col-sm-5 col-md-3 col-lg-3 img-responsive shopping-image">
	  <a href="<%= recipe_path(recipe) %>">
	    <% if recipe.images[0] %>
	      <%= image_tag(recipe.images[0].file.url) %>
	    <% else %>
	      <%= image_tag(Image.default_image_url) %>
	    <% end %>
	    <div><%= recipe.title %></div>
	  </a>

	</div>
      <% end %>
    <% end %>

    <% # Pad out the rest of the columns %>
    <% (0..3-list_length).each do %>
      <div class="hidden-xs col-sm-5 col-md-3 col-md-offset-1 col-lg-2 col-lg-offset-1 img-responsive shopping-image">
      </div>
    <% end %>

  </div>
</div>
